[sqlfluff]
dialect = bigquery
templater = jinja
sql_file_exts = .sql
max_line_length = 110

# Ignorar carpetas que dbt genera o dependencias
exclude = transform/dbt_packages,transform/target,transform/logs

# Recomendado: velocidad/consistencia al parsear jinja
runaway_limit = 10
large_file_skip_byte_limit = 0


[sqlfluff:lint]
# Mantener un lint estable con dbt/jinja (especialmente en stg)
per-file-ignores =
    transform/models/staging/**/*.sql:RF01,RF03,ST06
    transform/models/intermediate/**/*.sql:RF01,RF03


[sqlfluff:indentation]
tab_space_size = 4
indent_unit = space
template_blocks_indent = true
indented_joins = false
indented_using_on = true


[sqlfluff:rules:capitalisation.keywords]
capitalisation_policy = upper

[sqlfluff:rules:capitalisation.functions]
capitalisation_policy = upper

[sqlfluff:rules:capitalisation.literals]
# TRUE/FALSE/NULL en BigQuery suelen ir mejor en upper
capitalisation_policy = upper

[sqlfluff:rules:layout.long_lines]
ignore_comment_lines = true
ignore_comment_clauses = true


# Evitar falsos positivos con "keywords" (esto es más para nombres de columnas/tablas)
# Si te está pegando por palabras reservadas, suele ser por referencias.
[sqlfluff:rules:references.keywords]
ignore_words = network,users,url,date


[sqlfluff:templater:jinja]
apply_dbt_builtins = true

# Macros del proyecto
load_macros_from_path = transform/macros


# Stubs dbt para que sqlfluff no se rompa cuando no corre en contexto dbt
# (si usás sqlfluff-templater-dbt, idealmente sacás esto y usás el templater dbt)
[sqlfluff:templater:jinja:macros]
dbt_config = {% macro config() %}{% for k in kwargs %}{% endfor %}{% endmacro %}
dbt_ref = {% macro ref(model_ref) -%}{{ model_ref }}{%- endmacro %}
dbt_source = {% macro source(source_name, table) -%}{{ source_name }}_{{ table }}{%- endmacro %}
dbt_var = {% macro var(variable, default='') -%}{{ default }}{%- endmacro %}
dbt_is_incremental = {% macro is_incremental() -%}false{%- endmacro %}
